<!DOCTYPE HTML>

<link href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800|Open+Sans+Condensed:300,300italic,700' rel='stylesheet' type='text/css'>
<link href="/styles.css" media="screen, projection" rel="stylesheet" type="text/css" />

<!-- Markup -->
<div id="app-wrapper">
    <div id="question-wrapper"></div>
    <div id="face-wrapper"></div>
</div>


<!-- Templates -->
<script type="text/html" id="template-employee">
    <article class="employee">
        <img src="{{ url }}" />
        <span class="name hidden">
            <h2>{{ name }}</h2>
        </span>
    </article>
</script>

<script type="text/html" id="template-whois">
    <h1>Who is {{ name }}?</h1>
</script>


<!-- Libs -->
<script src="http://cdnjs.cloudflare.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
<script src="http://cdnjs.cloudflare.com/ajax/libs/lodash.js/2.4.1/lodash.min.js"></script>


<!-- Logic -->
<script>
$(function() {
    _.templateSettings = {
      interpolate: /\{\{(.+?)\}\}/g
    };


    var employeeTemplate = _.template($('#template-employee').html())
    var whoisTemplate = _.template($('#template-whois').html())

    var crntGame;


    $('#face-wrapper').delegate('.employee', 'click', function() {
        var name = $(this).find('h2').text();

        if (name === crntGame.name) {
            $(this).find('.hidden').removeClass('hidden').addClass('right');
            setTimeout(refresh, 2000);
        } else {
            $(this).find('.hidden').removeClass('hidden').addClass('wrong');
        }
    });

    var refresh = function() {
        crntGame = false;
        var $w = $('#face-wrapper');
        $w.empty();

        $.get('/api/game').then(function(data) {
            crntGame = data.selected;
            _.each(data.pool, function(e) {
                $w.append(employeeTemplate(e))
            });
            $('#question-wrapper').html(whoisTemplate(data.selected))
        });
    }

    refresh();

});
</script>
